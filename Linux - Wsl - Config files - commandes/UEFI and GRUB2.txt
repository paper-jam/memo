

-- ========= les commandes grub





-- ========== GRUB
    - The GRUB 2 EFI binary is grubx64.efi
    - grub.cfg is typically automatically generated by grub-mkconfig
    - Partition numbers in GRUB device names now start at 1.
    - GRUB 2 can read files directly from LVM and RAID devices
    - A graphical terminal and a graphical menu system are available

    - INSTALL
        For removable installs you have to use --removable --boot-directory and --efi-directory
        #grub-install --efi-directory=/mnt/usb --boot-directory=/mnt/usb/boot --removable

    --
        search.fs_uuid 3c7d5db9-ce39-466a-a140-a2a3cad03a46 root hd1,gpt2
        set prefix=($root)'/boot/grub'
        configfile $prefix/grub.cfg





-- =========== DIVERS

MBR is in the first sector of a bootable disk, so 512 bytes



- secure boot : mécanisme de blocage du lancement de noyaux ou chargeurs d'amorçage non signés appelé
- au démarrage le micro-micrologiciel recherche une partition ESP (EFI sytem Partition) sur tous les supports.
    - un logiciel dont la signature a été préalablement rentré la la mémoire non-volatile Nvme, qui fait partie de
        l'UEFI
    - soit, dans le cas d'un programme non signé, le fichier "bootx64.efi" situé en /EFI/BOOT/bootx64.efi.
        il faut alors que le mode SECURE boot soit désactivé

Les programmes efibootmgr, bcfg, permettent de configurer les entrées de la Nvme.

Pour lancer un système non-microsoft et non signé, il faudra donc désactiver :
    - le SECURE BOOT
    - la FAST BOOT
    - le LEGACY BOOT, de façon à bien rester en mode UEFI.

Le media doit être partionner en mode GPT
- avec une partition #1, en mode ESP, de 512 Mo, en FAT32, ave les flags boot,esp.

Deux méthodes pour lancer le SE :
- lancement direct du noyau
- utilisation dses gestionnaires de démarrage rEfind ou Grub-efi


-- ========== efibootmgr

c'est une application en espace utilisateur pour modifier la configuration du gestionnaire d'amorçage UEFI.
Elle peut créer et détruire des entrées d'amorçage, changer l'ordre de démarrage, modifier la prochaine option
de lancement du démarrage, et plus encore.



-- ====== the /boot directory
contains :
    - initrd
    - linux Kernel
        vmlinux : uncompressed format
        vmlinuz : compressed format
    - other files required to boot linux

which boot.cfg is taken



-- ======= TEST
/EFI/debian
-rwxr-xr-x 1 root root     121 mars  26 00:14 grub.cfg
















